<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="format-detection" content="telephone=no"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="viewport" content="width=640,user-scalable=no,target-densitydpi=device-dpi"/>
<meta HTTP-EQUIV="Pragma" CONTENT="no-cache">
<meta HTTP-EQUIV="Expires" CONTENT="-1">
<title>2016 ABB电力世界</title>
<meta http-equiv="Cache-Control" content="max-age=86400 public"/>
<meta  WXKey="uwin" WXDesc="领先技术 — 智能解决方案，了解更多信息，请点击查看" WXTitle="2016 ABB电力世界"  WXImg="http://client.adtmr.com/client/20161022/img/abb-sha.jpg" WXLink="http://client.adtmr.com/client/20161022/index.html" id="wx_share">
<link rel="stylesheet" href="css/basic.css">
</head>
<body>
	<div class="wrap">
		<div id="header">
			<a href="javascript:void(0)" class="backBtn"></a>
			<h2><i class="pos7"></i>互动游戏</h2>
			<a href="index.html" class="goIndex"></a>
		</div>
		<div class="inter-game-sha">
			<div class="text-warp">
				<a href="javascript:void(0)" class="close-Btn"></a>
				<h2>游戏规则</h2>
				<p>通过扫描展区明星展品及各场技术讲座结束页的二维码参与活动即可获得积分，累积一定积分数量并填写问卷后，可在展区礼品兑换台兑换相应礼品。</p>
				<h3>积分办法：</h3>
				<ol>
					<li>1. 参与展区互动，扫描明星展品处的二维码，点亮徽章并获取5分。</li>
					<li>2. 参加技术讲座，每个讲座结束后将显示一个二维码，通过微信扫描后，可获得10-20分。其中2日下午第六场讲座和3日上午第一场讲座可积20分，千万不要错过哦。</li>
				</ol>
				<h3>兑换规则：</h3>
				<p>积满120分可兑换一等奖；积满100分可兑换二等奖；积满80分可兑换三等奖；积满60分可兑换四等奖。<br><em>＊</em>每人仅可兑换一次奖品，礼品数量有限，先到先得。</p>
			</div>
			<div class="text-warp">
				<a href="javascript:void(0)" class="close-Btn"></a>
				<h1>您可前往展区奖品兑换台兑换礼品</h1>
				<div class="rect">
					<h2 style="text-align:center;padding: 26px 10px 6px;border-bottom: 1px solid #3d3b3c">领奖规则</h2>
					<ul>
						<li  class="clearfix"> <p>1等奖</p><p><i>120分</i></p><p><em>珍珠音符水果叉套装</em></p></li>
						<li  class="clearfix"> <p>2等奖</p><p><i>100分</i></p><p><em>多媒体套装或移动电源</em></p></li>
						<li  class="clearfix"> <p>3等奖</p><p><i>80分</i></p><p><em>旅行头枕</em></p></li>
						<li  class="clearfix"> <p>4等奖</p><p><i>60分</i></p><p><em>小熊布偶或运动水壶</em></p></li>
					</ul>
				</div>
			</div>
			<div class="text-warp">
				<a href="javascript:void(0)" class="close-Btn"></a>
				<h1 style="color:#ffffff">你还未填写问卷哦<br><a href="question.html">填写问卷</a>后即可兑换奖品</h1>
				<a href="question.html" class="queBtn">填写问卷</a>
			</div>
		</div>
		<div class="inter-game">
			<div class="inter-con">
				<h2 class="clearfix">总积分<p class="myScore"></p>    <span class="isActive">&nbsp;（未激活）</span><a href="javascript:void(0)" class="saoBtn"></a></h2>
				<ul id="dotList" class="list clearfix">
					<!-- <li>
						<span class="center">
							<em class="line pos1"></em>
							<em class="line pos2"></em>
							<em class="vert pos3"></em>
							<em class="vert pos4"></em>
						</span>
					</li>  -->
				</ul>
			</div>
			<div class="inter-pic">
				<h2>明星产品徽章</h2>
				<!-- 轮播图 -->
				<div class="swiper-container  badgeLists">
				    <div class="swiper-wrapper clearfix" id="priseList">
				        <div class="swiper-slide">
				        	<div class="pic ">
								<ul  class="clearfix">
									<li>
										<a href="javascript:void(0)">
											<i class="pos1" id="61"></i>
										</a>
									</li>
									<li>
										<a href="javascript:void(0)">
											<i class="pos2" id="62"></i>
										</a>
									</li>
									<li>
										<a href="javascript:void(0)">
											<i class="pos3" id="63"></i>
										</a>
									</li>
									<li>
										<a href="javascript:void(0)">
											<i class="pos4" id="64"></i>
										</a>
									</li>
									<li>
										<a href="javascript:void(0)">
											<i class="pos5" id="65"></i>
										</a>
									</li>
									<li>
										<a href="javascript:void(0)">
											<i class="pos6" id="66"></i>
										</a>
									</li>
								</ul>
							</div>
				        </div>
				        <div class="swiper-slide">
				        	<div class="pic">
								<ul  class="clearfix">
									<li>
										<a href="javascript:void(0)">
											<i class="pos7" id="67"></i>
										</a>
									</li>
									<li>
										<a href="javascript:void(0)">
											<i class="pos8" id="68"></i>
										</a>
									</li>
									<li>
										<a href="javascript:void(0)">
											<i class="pos9" id="69"></i>
										</a>
									</li>
									<li>
										<a href="javascript:void(0)">
											<i class="pos10" id="70"></i>
										</a>
									</li>
									<li>
										<a href="javascript:void(0)">
											<i class="pos11" id="71"></i>
										</a>
									</li>
									<li>
										<a href="javascript:void(0)">
											<i class="pos12" id="72"></i>
										</a>
									</li>
								</ul>
							</div>
				        </div>
				    </div>
			       	<div class="pagination">
			       		<span></span>
			       	</div>
			       	<a href="javascript:void(0);" class="arrow-left"></a>
        			<a href="javascript:void(0);" class="arrow-right"></a>
		    	</div>
			</div>
			<div class="game-bottom">
				<div class="gif-swiper-container">
					<div class="gif-swiper-wrapper" id="gifSwiper">
						<!-- <div class="gif-swiper-slide">
							<p>多媒体套装</p><span>43</span>
						</div> -->
					</div>
				</div>
				<i class="exBtn">兑换</i>
				<em class="helpBtn"></em>
			</div>
		</div>
		<div class="question-alert-sha">
			<div class="ques-alert">
				<h3></h3>
				<a href="javascript:void(0)" class="sureQuesBtn">确  定</a>
			</div>
		</div>	
	</div>
	<script src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script> 
	<script type="text/javascript" src="http://front.01event.com/cdn/js/jquery.min.js"></script>
	<script type="text/javascript" src="http://front.01event.com/cdn/js/swiper.2.min.js"></script>
	<script src="js/sao.js?v=1.0.2"></script>
	<script>
		$(function(){

			//验证弹窗按钮
			function questionFlex(data){
				$(".ques-alert h3").html(data);
				$(".question-alert-sha").show();
			}

			$(".question-alert-sha,.sureQuesBtn").click(function(){
				$(".question-alert-sha").hide();
			})

			$(".backBtn").click(function() {
				history.go(-1);
			});

			//获取威信配置
			ajaxGetWeiXinConf();

			/*点击关闭按钮*/
			$(".close-Btn").click(function(){
				$(".inter-game-sha").hide();
			});


			//徽章的轮播
			function setSwiper(){
				var mySwiper = new Swiper('.swiper-container',{
				    pagination: '.pagination',
				 	loop:true,
				 	autoplay : 2000,
				 	autoplayDisableOnInteraction : false,
				    paginationClickable: true
			 	});

			 	$('.arrow-left').on('click', function(e){
			   		e.preventDefault()
			   		mySwiper.swipePrev()
				});
				$('.arrow-right').on('click', function(e){
				   e.preventDefault()
				   mySwiper.swipeNext()
				});
			}

			//礼品的轮播
			function setGifs(num){
				var mySwiper2 = new Swiper('.gif-swiper-container',{
				 	wrapperClass : 'gif-swiper-wrapper',
				 	slideClass : 'gif-swiper-slide',
				    mode: 'vertical',
				    autoplay : 1500,
				    autoplayDisableOnInteraction : false,
				    onSlideChangeEnd: function(e){
				    	if(e.activeIndex == num){
				    		mySwiper2.destroy(true);
      						getGifs();
				    	}
      				}
			 	});
			}

			
			var openid = localStorage.getItem('openid');

			if(!openid){
				location.href = 'index.html';
			}else{
				//第一次进入  会弹出游戏规则
				var myFirstC = localStorage.getItem('myFirst');
				if(!myFirstC){
					$(".inter-game-sha").show();
					$(".text-warp").hide();
					$(".text-warp:eq(0)").show();
					localStorage.setItem('myFirst', 'hasCome');
				}
				userIndex();
			}
			//获取个人的积分情况，以及是否已答问卷
			function userIndex(){
				$.ajax({
			    	url: "http://abb2016.adtmr.com/abbfans/userindex",
			    	type:"post",
			    	data:{
			    		'user': openid
			    	},
			    	dataType:"jsonp",
			    	success: function(data){
			    		if(data.state != "0"){
			    			questionFlex(data.message);
			    			return false;
			    		}
			    		var _data = data.data;

			    		console.log(_data);


			    		var scroe = _data.score;
			    		var remark = _data.remark; //是否答题
			    		var pointers = _data.pointers;//已经扫描过的加分点
			    		var seals = _data.seals;

			    		$('.myScore').html(scroe);

			    		initScanLight(pointers);//棋盘亮

			    		initLight(seals);//徽章变亮
			    		exchange(remark);//是否已答问卷
			    	
			    	},
			    	error : function(){
			    		//alert('系统暂时繁忙，请稍后再试！');
			    		questionFlex('系统暂时繁忙，请稍后再试！')
			    	}
				});
			}

			/*
			*图章变量
			* arr 数组
			**/
			function initScanLight(arr){
				var arr = parseInt(arr);
				//创建60个点
				var _dotHtml = '';
				for(var i=1; i <= 60; i++){
					_dotHtml += '<li>';
					_dotHtml += '<span class="center">';
					_dotHtml += '<em class="line pos1"></em>';
					_dotHtml += '<em class="line pos2"></em>';
					_dotHtml += '<em class="vert pos3"></em>';
					_dotHtml += '<em class="vert pos4"></em>';
					_dotHtml += '</span>';
					_dotHtml += '</li>';
				}

				$('#dotList').html(_dotHtml);//添加60个点
				if(arr>0){
					for(var i=0; i < arr; i++){
						var pointNum = parseInt(i);
						$("#dotList li").eq(pointNum).find('span').addClass('active');
					}
				}
				
			}

			//徽章变亮
			function  initLight(arr){
				var len = arr.length;
				if(len>0){
					for(var i=0;i<len;i++){
						var lightId = parseInt(arr[i].id);
						$("#priseList i[id="+lightId+"]").parent().addClass("active");

					}
				}
				setSwiper();
			}
			//获取礼物请求
			getGifs();
			function getGifs(){
				$.ajax({
			    	url: "http://abb2016.adtmr.com/abbfans/getawardsinfo",
			    	type:"post",
			    	dataType:"jsonp",
			    	success: function(data){
			    		console.log(data);
			    		if(data.state != "0"){
			    			questionFlex(data.message);
			    			return false;
			    		}else{
       						setdata(data.data,data.data.length);

			    		}
			    	},
			    	error : function(){
			    		questionFlex('系统繁忙，请稍后再试！')
			    	}
				});
			}

			/*
			*礼品更新
			* arr 数组
			**/
			function setdata(arr,num){
				var gifsHtml= '';
				for(var i=0;i<arr.length;i++){
					gifsHtml+='<div class="gif-swiper-slide clearfix">';
					gifsHtml+='<p class="fl">'+arr[i].name+'</p><span class="fl">'+arr[i].lastNum+'</span>';
					gifsHtml+='</div>';
				}
				$('#gifSwiper').prepend(gifsHtml);
				setGifs(num);
			}

			/*
			*兑换前判断是否已答问卷
			**/
			function exchange(key){
				$(".exBtn").attr('remark',key);

				if(key=='true'){
					$(".isActive").css({"color":"#ff6c00"}).html('&nbsp;&nbsp;'+'(已激活)');
				}
			}

			$(".exBtn").click(function(){
				var remark = $(".exBtn").attr('remark');
				console.log(remark)
				if(remark=='true'){
					$(".inter-game-sha").show();
					$(".text-warp").hide();
					$(".text-warp:eq(1)").show();
					return;
				}else{
					$(".inter-game-sha").show();
					$(".text-warp").hide();
					$(".text-warp:eq(2)").show();
					return;
				}
			})

			/*帮助按钮*/

			$(".helpBtn").click(function(){
				$(".inter-game-sha").show();
				$(".text-warp").hide();
				$(".text-warp:eq(0)").show();
			})
			
		})
	</script>
</body>
</html>